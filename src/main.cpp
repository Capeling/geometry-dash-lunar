#include "defs/all.h"
#include "defs/utils.h"
#include <Geode/modify/SongCell.hpp>

$on_mod(Loaded) {
	int levelStart = 1;
	int levels = 4;
	std::vector<unsigned char> levelsBytes = PatchTool::intToBytes(levelStart + levels);
	std::vector<unsigned char> levelStartByte = PatchTool::intToBytes(levelStart);
	std::vector<unsigned char> songBytes = PatchTool::intToBytes(39 + levels);
	PatchTool::patch(0x2680bf, {0xbe, levelStartByte[0], 0x00, 0x00, 0x00});
	PatchTool::patch(0x26812e, {levelsBytes[0]});
	PatchTool::patch(0x268386, {0x83, 0xfe, levelsBytes[0]});
	PatchTool::patch(0x26838b, {0x6a, PatchTool::intToBytes((levelStart + levels) - 1)[0]});
	PatchTool::patch(0x268398, {0x6a, levelsBytes[0]});

	PatchTool::patch(0x92283, {0xba, songBytes[0], 0x00, 0x00, 0x00});
    PatchTool::patch(0x92276, {0x83, 0xf8, songBytes[0]});
    PatchTool::patch(0x922c2, {0xba, songBytes[0], 0x00, 0x00, 0x00});

	// Replace default songs with Lunar songs in SongsLayer
	// Active
	PatchTool::patch(0x38c141, {0xc7, 0x40, 0x34, 0x28});
	// Thunderzone
	PatchTool::patch(0x38c18f, {0xc7, 0x40, 0x34, 0x29});
	// Earthsplitter
	PatchTool::patch(0x38c1de, {0xc7, 0x40, 0x34, 0x2a});
	// Space Battle
	PatchTool::patch(0x38c22d, {0xc7, 0x40, 0x34, 0x2b});

	// Get rid of the other default songs from SongsLayer
	// Base After Base *
	PatchTool::patch(0x38c28c, {0x90, 0x90, 0x90, 0x90, 0x90, 0x90});
	// Cant Let Go *
	PatchTool::patch(0x38c2db, {0x90, 0x90, 0x90, 0x90, 0x90, 0x90});
	// Jumper *
	PatchTool::patch(0x38c32a, {0x90, 0x90, 0x90, 0x90, 0x90, 0x90});
	// Time Machine *
	PatchTool::patch(0x38c379, {0x90, 0x90, 0x90, 0x90, 0x90, 0x90});
	// Cycles *
	PatchTool::patch(0x38c3c8, {0x90, 0x90, 0x90, 0x90, 0x90, 0x90});
	// xStep *
	PatchTool::patch(0x38c417, {0x90, 0x90, 0x90, 0x90, 0x90, 0x90});
	// Clutterfunk *
	PatchTool::patch(0x38c466, {0x90, 0x90, 0x90, 0x90, 0x90, 0x90});
	// TOE *
	PatchTool::patch(0x38c4b5, {0x90, 0x90, 0x90, 0x90, 0x90, 0x90});
	// Electroman *
	PatchTool::patch(0x38c504, {0x90, 0x90, 0x90, 0x90, 0x90, 0x90});
	// Clubstep *
	PatchTool::patch(0x38c553, {0x90, 0x90, 0x90, 0x90, 0x90, 0x90});
	// Electrodynamix *
	PatchTool::patch(0x38c5a2, {0x90, 0x90, 0x90, 0x90, 0x90, 0x90});
	// Hexagon Force *
	PatchTool::patch(0x38c5f1, {0x90, 0x90, 0x90, 0x90, 0x90, 0x90});
	// Blast Processing *
	PatchTool::patch(0x38c640, {0x90, 0x90, 0x90, 0x90, 0x90, 0x90});
	// TOE2 *
	PatchTool::patch(0x38c68f, {0x90, 0x90, 0x90, 0x90, 0x90, 0x90});
	// Geometrical *
	PatchTool::patch(0x38c6de, {0x90, 0x90, 0x90, 0x90, 0x90, 0x90});
	// Deadlocked *
	PatchTool::patch(0x38c72d, {0x90, 0x90, 0x90, 0x90, 0x90, 0x90});
	// Fingerdash *
	PatchTool::patch(0x38c77c, {0x90, 0x90, 0x90, 0x90, 0x90, 0x90});
	// Dash *
	PatchTool::patch(0x38c7cb, {0x90, 0x90, 0x90, 0x90, 0x90, 0x90});
}

class $modify(SongCell) { //why is this in main? because i cant be fucked making new files for this small shit
	void loadFromObject(SongObject* object) {
		SongCell::loadFromObject(object);

		int audioID = MBO(int, object, 0x34);
		auto songLabel = getChildOfType<CCLabelBMFont>(m_mainLayer, 0);

		songLabel->setString(LevelTools::getAudioTitle(audioID).c_str()); //for some fucking reason hooking artistForAudio breaks this so i have to manually fix it.
		if(audioID == -1)
			songLabel->setScale(0.573);
	}
};